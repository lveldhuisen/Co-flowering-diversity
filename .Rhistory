head(Road22data)
#remove extra x column
Road22data = subset(Road22data, select = -c(X) )
head(Road22data)
#rename SI column to weight
colnames(Road22data)[3] ="weight"
head(Road22data)
# Duplicate data frame
Road_positive <- Road22data
# Set negative values to 0
Road_positive[Road_positive < 4.46e-14] <- 0
Road_positive
Road22data <- Road_positive
#remove all NAs
Road22data <- na.omit(Road22data)
fivenum(Road22data$weight)
#make igraph object
graph_from_data_frame(d=Road22data, directed = FALSE)
Road22_igraph=graph_from_data_frame(d=Road22data,directed = FALSE)
print(Road22_igraph)
head(Road22_igraph)
plot(Road22_igraph,edge.arrow.size=.5, vertex.color="gold", vertex.size=3,
vertex.frame.color="blue", vertex.label=V(pfeiler21_igraph)$species1, vertex.label.color="black",
vertex.label.cex=.5, vertex.label.dist=2, edge.curved=0.5,edge.width=weights, layout=layout_with_lgl)
##Pfeiler 2022##############################
#bring in and format data
Pfeiler22data <- read.csv("cleanPfeiler22.csv", header = TRUE)
head(Pfeiler22data)
#remove x column
Pfeiler22data = subset(Pfeiler22data, select = -c(X) )
#rename SI column to weight
colnames(Pfeiler22data)[3] ="weight"
head(Pfeiler22data)
# Duplicate data frame
Pfeiler_positive <- Pfeiler22data
# Set negative values to 0
Pfeiler_positive[Pfeiler_positive < 4.46e-14] <- 0
Pfeiler_positive
Pfeiler22data <- Pfeiler_positive
#remove all NAs
Pfeiler22data <- na.omit(Pfeiler22data)
fivenum(Pfeiler22data$weight)
hist(Pfeiler22data$weight)
#make igraph object
graph_from_data_frame(d=Pfeiler22data, directed = FALSE)
Pfeiler22_igraph=graph_from_data_frame(d=Pfeiler22data,directed = FALSE)
print(Pfeiler22_igraph)
head(Pfeiler22_igraph)
###calculate modularity################
communitiesPf22 <- cluster_louvain(Pfeiler22_igraph, weights = NULL, resolution = 1)
membership(communitiesPf22)
Pf22mod <- modularity(communitiesPf22)
##PBM 2022##############################
#bring in and format data
PBM22data <- read.csv("cleanPBM22.csv", header = TRUE)
head(PBM22data)
#remove x column
PBM22data = subset(PBM22data, select = -c(X) )
#rename SI column to weight
colnames(PBM22data)[3] ="weight"
head(PBM22data)
# Duplicate data frame
PBM_positive <- PBM22data
# Set negative values to 0
PBM_positive[PBM_positive < 4.46e-14] <- 0
PBM_positive
PBM22data <- PBM_positive
#remove all NAs
PBM22data <- na.omit(PBM22data)
fivenum(PBM22data$weight)
#make igraph object
graph_from_data_frame(d=PBM22data, directed = FALSE)
PBM22_igraph=graph_from_data_frame(d=PBM22data,directed = FALSE)
print(PBM22_igraph)
head(PBM22_igraph)
class(PBM22_igraph)
### calcualte modularity#############
communitiesPBM22 <- cluster_louvain(PBM22_igraph, weights = NULL, resolution = 1)
membership(communitiesPBM22)
PBM22mod <- modularity(communitiesPBM22)
install.packages("bipartite")
library(bipartite)
install.packages("vegan")
library(vegan)
install.packages("Matrix")
library(Matrix)
install.packages("vegan")
##Road 2021##############################
#turn igraph object from above back into matrix
road21_matrix <- as.matrix(as_adjacency_matrix(road21_igraph))
library(bipartite)
library(vegan)
library(Matrix)
##Road 2021##############################
#turn igraph object from above back into matrix
road21_matrix <- as.matrix(as_adjacency_matrix(road21_igraph))
##Road 2021##############################
#turn igraph object from above back into matrix
road21_matrix <- as.matrix(as_adjacency_matrix(road21_igraph))
#create null networks
road21_null <- nullmodel(road21_matrix, method="r2d")
install.packages("igraph")
install.packages("igraph")
library(igraph)
library(igraph)
##Road 2021##############################
#turn igraph object from above back into matrix
road21_matrix <- as.matrix(as_adjacency_matrix(road21_igraph))
#create null networks
road21_null <- nullmodel(road21_matrix, method="r2d")
print(road21_null)
class(road21_null)
graph
##Road 2021##############################
#turn igraph object from above back into matrix
road21_matrix <- as.matrix(as_adjacency_matrix(road21_igraph))
#create null networks
road21_null <- nullmodel(road21_matrix, method="r2d")
library(bipartite)
library(vegan)
library(Matrix)
library(igraph)
#create null networks
road21_null <- nullmodel(road21_matrix, method="r2d")
print(road21_null)
class(road21_null)
graph
#create empty vector
null_modularity = c()
#create list with null network modularity values
for (i in 1:length(road21_null)) {
current_model = road21_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
null_modularity = append(null_modularity,current_modularity)
}
#calculate z scores for Road 21 nulls
hist(null_modularity)
R21Z <- (R21mod - mean(null_modularity))/sd(null_modularity)
R21Z
##Pfeiler 2021##############################
#turn igraph object back into matrix
pfeiler21_matrix <- as.matrix(as_adjacency_matrix(pfeiler21_igraph))
#create nullnetworks
pfeiler21_null <- nullmodel(pfeiler21_matrix, method="r2d")
print(pfeiler21_null)
class(pfeiler21_null)
graph
#create empty vector
PF21null_modularity = c()
#create list with null network modularity values
for (i in 1:length(pfeiler21_null)) {
current_model = pfeiler21_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
PF21null_modularity = append(PF21null_modularity,current_modularity)
}
#calculate z scores for pfeiler 21 nulls
PF21Z <- (Pf21mod - mean(PF21null_modularity))/sd(PF21null_modularity)
PF21Z
##PBM 2021##############################
#turn igraph object back into matrix
PBM21_matrix <- as.matrix(as_adjacency_matrix(PBM21_igraph))
#create nullnetworks
PBM21_null <- nullmodel(PBM21_matrix, method="r2d")
print(PBM21_null)
class(PBM21_null)
#create empty vector
PBM21null_modularity = c()
#create list with null network modularity values
for (i in 1:length(PBM21_null)) {
current_model = PBM21_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
PBM21null_modularity = append(PBM21null_modularity,current_modularity)
}
PBM21Z <- (PBM21mod - mean(PBM21null_modularity))/sd(PBM21null_modularity)
PBM21Z
hist(PBM21null_modularity)
##Road 2022##############################
#turn igraph object back into matrix
road22_matrix <- as.matrix(as_adjacency_matrix(Road22_igraph))
#create null networks
road22_null <- nullmodel(road22_matrix, method="r2d")
print(road22_null)
class(road22_null)
#create empty vector
R22null_modularity = c()
#create list with null network modularity values
for (i in 1:length(road22_null)) {
current_model = road22_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
R22null_modularity = append(R22null_modularity,current_modularity)
}
#calculate z scores for Road 22 nulls
R22Z <- (R22mod - mean(R22null_modularity))/sd(R22null_modularity)
R22Z
#calculate z scores for Road 22 nulls
R22Z <- (R22mod - mean(R22null_modularity))/sd(R22null_modularity)
#create empty vector
R22null_modularity = c()
#create list with null network modularity values
for (i in 1:length(road22_null)) {
current_model = road22_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
R22null_modularity = append(R22null_modularity,current_modularity)
}
#calculate z scores for Road 22 nulls
R22Z <- (R22mod - mean(R22null_modularity))/sd(R22null_modularity)
##Road 2022##############################
#turn igraph object back into matrix
road22_matrix <- as.matrix(as_adjacency_matrix(Road22_igraph))
#create null networks
road22_null <- nullmodel(road22_matrix, method="r2d")
print(road22_null)
class(road22_null)
#create empty vector
R22null_modularity = c()
#create list with null network modularity values
for (i in 1:length(road22_null)) {
current_model = road22_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
R22null_modularity = append(R22null_modularity,current_modularity)
}
#calculate z scores for Road 22 nulls
R22Z <- (R22mod - mean(R22null_modularity))/sd(R22null_modularity)
###calcualte modularity##########
communitiesRoad22 <- cluster_louvain(Road22_igraph, weights = NULL, resolution = 1)
membership(communitiesRoad22) #see species in each module
R22mod <- modularity(communitiesRoad22) #save modularity value
##Road 2022##############################
#turn igraph object back into matrix
road22_matrix <- as.matrix(as_adjacency_matrix(Road22_igraph))
#create null networks
road22_null <- nullmodel(road22_matrix, method="r2d")
print(road22_null)
class(road22_null)
#create empty vector
R22null_modularity = c()
#create list with null network modularity values
for (i in 1:length(road22_null)) {
current_model = road22_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
R22null_modularity = append(R22null_modularity,current_modularity)
}
#calculate z scores for Road 22 nulls
R22Z <- (R22mod - mean(R22null_modularity))/sd(R22null_modularity)
R22Z
##Pfeiler 2022##############################
#turn igraph object back into matrix
pfeiler22_matrix <- as.matrix(as_adjacency_matrix(Pfeiler22_igraph))
#create null networks
pfeiler22_null <- nullmodel(pfeiler22_matrix, method="r2d")
print(pfeiler22_null)
class(pfeiler22_null)
#create empty vector
Pf22null_modularity = c()
#create list with null network modularity values
for (i in 1:length(pfeiler22_null)) {
current_model = pfeiler22_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
Pf22null_modularity = append(Pf22null_modularity,current_modularity)
}
#calculate z scores for pfeiler 2022 nulls
Pf22Z <- (Pf22mod - mean(Pf22null_modularity))/sd(Pf22null_modularity)
Pf22Z
##PBM 2022##############################
#turn igraph object back into matrix
PBM22_matrix <- as.matrix(as_adjacency_matrix(PBM22_igraph))
#create null networks
PBM22_null <- nullmodel(PBM22_matrix, method="r2d")
print(PBM22_null)
class(PBM22_null)
#create empty vector
PBM22null_modularity = c()
#create list with null network modularity values
for (i in 1:length(PBM22_null)) {
current_model = PBM22_null[[i]]
igraphcurrent = graph_from_adjacency_matrix(current_model,mode = "undirected")
current_analysis = cluster_louvain(igraphcurrent, weights = NULL, resolution = 1)
current_modularity = modularity(current_analysis)
PBM22null_modularity = append(PBM22null_modularity,current_modularity)
}
#calculate z scores for pbm 2022 nulls
PBM22Z <- (PBM22mod - mean(PBM22null_modularity))/sd(PBM22null_modularity)
PBM22Z
#packages
install.packages("ape")
install.packages("geiger")
library(ape)
library(geiger)
#just for me, ignore for review
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/RMBL phylogeny/Smith&Brown18")
#import Smith & Brown 2018 tree and check data
SBtree <- read.tree(file = "ALLMB.tre")
is.rooted(SBtree) #check tree
#ignore for review
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
#make community matrix
matrix2021 <- read.table("2021_community_matrix.txt", sep = "\t", header = T, row.names = 1)
matrix2021[1, matrix2021[1,]>0]
#make community matrix
matrix2021 <- read.table("2021_community_matrix.txt", sep = "\t", header = T, row.names = 1)
#make community matrix
matrix2021 <- read.table("2021_community_matrix.txt", sep = "\t", header = T, row.names = 1)
###PBM 2021###################################################
richnessPBM21 = length(matrix2021[1, matrix2021[1,]>0])
#prune tree to just these species for PBM
pruned.treePBM21 <- treedata(SBtree, unlist(matrix2021[1,matrix2021[1,]>0]), warnings = F)$phy
class(pruned.treePBM21)
pruned.treePBM21
plot(pruned.treePBM21)
###all 2021 together###############
prune.sum.function <- function(x){
tmp.tree <- treedata(SBtree, x[x>0])$phy
sum(tmp.tree$edge.length)
}
PD21 <- apply(matrix2021, MARGIN = 1, prune.sum.function)
print(PD21)
library(picante)
ses.pd(matrix2021, pruned.tree2021, null.model = c("sample.pool"),
runs = 5000, iterations = 5000, include.root=TRUE)
###standard effect sizes using picante ####################
pruned.tree2021 <- treedata(SBtree, unlist(matrix2021[4,matrix2021[4,]>0]), warnings = F)$phy
ses.pd(matrix2021, pruned.tree2021, null.model = c("sample.pool"),
runs = 5000, iterations = 5000, include.root=TRUE)
#make community matrix
matrix2022 <- read.table("2022_community_matrix.txt", sep = "\t", header = T, row.names = 1)
###all sites in matrix with one code###############
prune.sum.function <- function(x){
tmp.tree <- treedata(SBtree, x[x>0])$phy
sum(tmp.tree$edge.length)
}
PD22 <- apply(matrix2022, MARGIN = 1, prune.sum.function)
print(PD22)
library(ape)
library(geiger)
library(picante)
#just for me, ignore for review
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/RMBL phylogeny/Smith&Brown18")
#ignore for review
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
#make community matrix
matrix2021 <- read.table("2021_community_matrix.txt", sep = "\t", header = T, row.names = 1)
###PBM 2021###################################################
#prune tree to just these species for PBM
pruned.treePBM21 <- treedata(SBtree, unlist(matrix2021[1,matrix2021[1,]>0]), warnings = F)$phy
class(pruned.treePBM21)
pruned.treePBM21
plot(pruned.treePBM21)#check tree
#Faith's index for PBM2021
sum(pruned.treePBM21$edge.length)
###Pfeiler 2021###############################
#prune tree
pruned.treePf21 <- treedata(SBtree, unlist(matrix2021[2,matrix2021[2,]>0]), warnings = F)$phy
class(pruned.treePf21)
pruned.treePf21
plot(pruned.treePf21) #check tree
###Road 2021##############################
#prune tree
pruned.treeroad21 <- treedata(SBtree, unlist(matrix2021[3,matrix2021[3,]>0]), warnings = F)$phy
class(pruned.treeroad21)
pruned.treeroad21
plot(pruned.treeroad21)#check tree
###all 2021 together###############
prune.sum.function <- function(x){
tmp.tree <- treedata(SBtree, x[x>0])$phy
sum(tmp.tree$edge.length)
}
PD21 <- apply(matrix2021, MARGIN = 1, prune.sum.function)
print(PD21)
###standard effect sizes using picante ####################
pruned.tree2021 <- treedata(SBtree, unlist(matrix2021[4,matrix2021[4,]>0]), warnings = F)$phy
ses.pd(matrix2021, pruned.tree2021, null.model = c("sample.pool"),
runs = 5000, iterations = 5000, include.root=TRUE) #output shows standard effect size and absolute value of PD
##2022 --------------------------------------------
#ignore for review, this file is available in "files_phylogeneticmetrics_bysite" folder
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
#make community matrix
matrix2022 <- read.table("2022_community_matrix.txt", sep = "\t", header = T, row.names = 1)
###PBM 2022##########################################################
#prune tree to just these species for PBM
pruned.treePBM22 <- treedata(SBtree, unlist(matrix2022[1,matrix2022[1,]>0]), warnings = F)$phy
class(pruned.treePBM22)
pruned.treePBM22
plot(pruned.treePBM22) #check tree
#Faith's index for PBM2022
sum(pruned.treePBM22$edge.length)
###Pfeiler 2022##########################################################
#prune tree to just these species for Pfeiler
pruned.treePf22 <- treedata(SBtree, unlist(matrix2022[2,matrix2022[2,]>0]), warnings = F)$phy
class(pruned.treePf22)
pruned.treePf22
plot(pruned.treePf22) #check tree
#Faith's index for pfeiler 2022
sum(pruned.treePf22$edge.length)
###Road 2022##########################################################
#prune tree to just these species for road
pruned.treeroad22 <- treedata(SBtree, unlist(matrix2022[3,matrix2022[3,]>0]), warnings = F)$phy
class(pruned.treeroad22)
pruned.treeroad22
plot(pruned.treeroad22)
#Faith's index for pfeiler 2022
sum(pruned.treeroad22$edge.length)
###all sites in matrix with one code###############
prune.sum.function <- function(x){
tmp.tree <- treedata(SBtree, x[x>0])$phy
sum(tmp.tree$edge.length)
}
PD22 <- apply(matrix2022, MARGIN = 1, prune.sum.function)
print(PD22)
pruned.tree2022 <- treedata(SBtree, unlist(matrix2022[4,matrix2022[4,]>0]), warnings = F)$phy
plot(pruned.tree2022)
ses.pd(matrix2022, pruned.tree2022, null.model = c("sample.pool"),
runs = 5000, iterations = 5000, include.root=TRUE)
#MPD-------------------------------------------------------------
##2021################
###Road 2021##############################################
plot.phylo(pruned.treeroad21)
dist.matR21 <- cophenetic(pruned.treeroad21) #make distance matrix from phylogeny
mpd_r21<- mean(as.dist(dist.matR21))
mpd_2021 <- apply(matrix2021, MARGIN = 1, new.mpd.function)
#function to do mpd for all sites
new.mpd.function <- function(x){
com.names<- names(x[x>0])
mean(as.dist(dist.mat2021[com.names,com.names]))
}
mpd_2021 <- apply(matrix2021, MARGIN = 1, new.mpd.function)
function (m, diag = FALSE, upper = FALSE)
pruned.tree2021 <- treedata(SBtree, unlist(matrix2021[4,matrix2021[4,]>0]), warnings = F)$phy
plot(pruned.tree2021)
dist.mat2021 <- cophenetic(pruned.tree2021) #make distance matrix from phylogeny
dist.mat2021 #check distance matrix
###all sites together################################
#create distance matrix for all 2021 species
#need to figure out how to trim SB phylogeny but include all rows
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
pruned.tree2021 <- treedata(SBtree, unlist(matrix2021[4,matrix2021[4,]>0]), warnings = F)$phy
dist.mat2021 <- cophenetic(pruned.tree2021) #make distance matrix from phylogeny
dist.mat2021 #check distance matrix
#function to do mpd for all sites
new.mpd.function <- function(x){
com.names<- names(x[x>0])
mean(as.dist(dist.mat2021[com.names,com.names]))
}
mpd_2021 <- apply(matrix2021, MARGIN = 1, new.mpd.function)
print(mpd_2021)
mpd_2022 <- apply(matrix2022, MARGIN = 1, new.mpd.function) #save MPD values
dist.mat2021 <- cophenetic(pruned.tree2021) #make distance matrix
###Road 2021################
road21.sample <- matrix2021[3, matrix2021[3,]>0]
mntd.R21 <- mntd(matrix2021[3, matrix2021[3,]>0], cophenetic(pruned.tree2021), abundance.weighted = F)
View(road21.sample)
##2022--------------------------------------------------------------------
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
matrix2022 <- read.table("2022_community_matrix.txt", sep = "\t", header = T, row.names = 1)
##2021############
###Road 2021######
class(dist.matR21)
dist.matR21[lower.tri(dist.matR21, diag = TRUE)] <- ""
Road21_PD <- as.data.frame(as.table(dist.matR21))
Road21_PD["Freq"][Road21_PD["Freq"] == ''] <- NA
na.omit(Road21_PD)
print(Road21_PD)
#import S&B18 tree and check data
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/RMBL phylogeny/Smith&Brown18")
#import S&B18 tree and check data
#file available in "files_phylogeneticetrics_bymodule" folder
SBtree <- read.tree(file = "ALLMB.tre")
#import S&B18 tree and check data
#file available in "files_phylogeneticetrics_bymodule" folder
SBtree <- read.tree(file = "ALLMB.tre")
#community matrix with my data
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
matrix2021.mod <- read.table("2021_community_matrix_modules.txt", sep = "\t", header = T, row.names = 1)
#Faith's PD-------------------------------------------------------------------
##2021#################
prune.sum.function <- function(x){
tmp.tree <- treedata(SBtree, x[x>0])$phy
sum(tmp.tree$edge.length)
}
PD21.mod <- apply(matrix2021.mod, MARGIN = 1, prune.sum.function)
print(PD21.mod)
PD21.mod
##2022#####################################
setwd("~/Library/CloudStorage/OneDrive-UniversityofArizona/Arizona PhD/Research/Chapter 1")
matrix2022.mod <- read.table("2022_community_matrix_modules.txt", sep = "\t", header = T, row.names = 1)
PD22.mod <- apply(matrix2022.mod, MARGIN = 1, prune.sum.function)
print(PD22.mod)
PD22.mod
#MNTD------------------------------------------------------------------------
##2021###############
new.mntd.function <- function(x){
com.names <- names(x[x>0])
my.com.dist <- dist.mat2021[com.names,com.names]
diag(my.com.dist) <- NA
mean(apply(my.com.dist, MARGIN = 1, min), na.rm=TRUE)
}
mntd.2021.mod <- apply(matrix2021.mod, MARGIN = 1, new.mntd.function)
